<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Preview - Styled Page</title>
  <link rel="stylesheet" href="/assets/application.css" />

  <!-- Example style adapted from your provided markup -->
  <style>
    :root {
      --issue-background: #971403;
      --issue-web-background: #291319;
      --issue-text: #ffffff;
      --accent-1: #0095a9;
      --accent-2: #f1a5d8;
      --accent-3: #8b0b56;
      --muted: rgba(255,255,255,0.85);
    }

    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:var(--issue-web-background);color:var(--issue-text);-webkit-font-smoothing:antialiased}

    .site-header{background:var(--issue-background);color:#000;padding:14px 20px}
    .top-bar-primary{font-weight:600}
    .institutional-account-identifier{font-size:13px;opacity:.95}

    main#main{max-width:1100px;margin:28px auto;padding:24px}
    .section-header{font-size:22px;margin:0 0 18px 0;border-top:3px solid rgba(255,255,255,0.06);padding-top:12px}

    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:20px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(0,0,0,0.02));border-radius:6px;padding:18px}
    .blog_post__title{font-size:18px;margin:0 0 6px 0;color:var(--issue-text)}
    .blog_post__authors{font-size:13px;color:var(--muted);margin-bottom:10px}
    .blog_post__excerpt p{margin:0;color:rgba(255,255,255,0.9)}

    .button{display:inline-block;padding:8px 12px;border-radius:4px;text-decoration:none;font-weight:600;color:#fff;border:1px solid rgba(255,255,255,0.12);background:transparent}
    .button:hover{background:rgba(255,255,255,0.04)}
    .button.primary{background:var(--issue-background);color:#fff;border-color:transparent}

    footer#site-footer{padding:22px;text-align:center;color:rgba(255,255,255,0.6);font-size:13px}

    /* small screens */
    @media (max-width:720px){
      .grid{grid-template-columns:1fr}
      main#main{padding:14px}
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="top-bar-primary">Preview — Styled Layout</div>
  </header>

  <main id="main">
    <section class="content">
      <h1 class="section-header">Preview: Sidecar Layout (styled)</h1>

      <nav style="display:flex;gap:12px;margin:18px 0 26px 0;align-items:center">
        <a href="./librairie/index.html" class="button" onclick="openWindow('win-librairie');return false;">librairie</a>
        <a href="./poeme/index.html" class="button" onclick="openWindow('win-poeme');return false;">Poème</a>
        <a href="./pense/index.html" class="button" onclick="openWindow('win-pense');return false;">Pense à toi</a>
        <a href="./souvenir/index.html" class="button" onclick="openWindow('win-souvenir');return false;">Souvenir</a>
      </nav>

      <div class="grid">
        <div class="card">
          <h2 class="blog_post__title">Painted Bodies</h2>
          <div class="blog_post__authors">Owen Hatherley</div>
          <div class="blog_post__excerpt"><p>On Aleksandr Deineka.</p></div>
          <div style="margin-top:14px"><a class="button primary" href="#">Read</a></div>
        </div>

        <div class="card">
          <h2 class="blog_post__title">Confections</h2>
          <div class="blog_post__authors">Lily Lynch</div>
          <div class="blog_post__excerpt"><p>On Sanna Marin’s memoir.</p></div>
          <div style="margin-top:14px"><a class="button primary" href="#">Read</a></div>
        </div>
      </div>

    </section>
  </main>

  <footer id="site-footer">© New Left Review Ltd 2025</footer>
</body>
</html>

<!-- Modal windows markup + behavior -->
<div id="overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);z-index:9998"></div>

<div id="win-librairie" class="modal" aria-hidden="true" style="display:none">
  <div class="modal-inner">
    <button class="modal-close" onclick="closeWindow('win-librairie')">✕</button>
    <h3>librairie</h3>
    <div id="win-librairie-content">Chargement…</div>
  </div>
</div>

<div id="win-poeme" class="modal" aria-hidden="true" style="display:none">
  <div class="modal-inner">
    <button class="modal-close" onclick="closeWindow('win-poeme')">✕</button>
    <h3>Poème</h3>
    <div id="win-poeme-content">Chargement…</div>
  </div>
</div>

<div id="win-pense" class="modal" aria-hidden="true" style="display:none">
  <div class="modal-inner">
    <button class="modal-close" onclick="closeWindow('win-pense')">✕</button>
    <h3>Pense à toi</h3>
    <div id="win-pense-content">Chargement…</div>
  </div>
</div>

<div id="win-souvenir" class="modal" aria-hidden="true" style="display:none">
  <div class="modal-inner">
    <button class="modal-close" onclick="closeWindow('win-souvenir')">✕</button>
    <h3>Souvenir</h3>
    <div id="win-souvenir-content">Chargement…</div>
  </div>
</div>

<style>
  .modal{position:fixed;z-index:9999;left:50%;top:50%;transform:translate(-50%,-50%);min-width:320px;max-width:880px;background:#151515;border-radius:8px;padding:22px;box-shadow:0 10px 40px rgba(0,0,0,0.6);color:#fff}
  .modal-inner{position:relative}
  .modal-close{position:absolute;right:10px;top:8px;background:transparent;border:0;color:rgba(255,255,255,0.85);font-size:18px;cursor:pointer}
  .modal a{color:#fff}
  .modal p, .modal h1, .modal h2, .modal h3, .modal li{color:#fff}
  @media (max-width:720px){.modal{width:92%;left:50%;top:45%;transform:translate(-50%,-45%)}}
</style>

<script>
  function openWindow(id){
    var el = document.getElementById(id);
    if(!el) return;
    document.getElementById('overlay').style.display='block';
    el.style.display='block';
    el.setAttribute('aria-hidden','false');

    // If opening any window with id starting with "win-", lazy-load matching file from either
    // "./slug.html" or "./slug/index.html" (try them in order). Relative paths work when
    // serving locally or via GitHub Pages. Anchors also provide a fallback link.
    if(id && id.indexOf('win-') === 0){
      var target = document.getElementById(id + '-content');
      if(target && !target.dataset.loaded){
        var slug = id.replace(/^win-/, '');
        var attempts = [ './' + slug + '.html', './' + slug + '/index.html' ];

        // Try each path in sequence until one succeeds
        (function tryNext(i){
          if(i >= attempts.length){
            target.innerHTML = '<p>Impossible de charger le contenu. Placez un fichier <code>' + slug + '.html</code> à la racine du site (ou <code>./' + slug + '/index.html</code>), puis servez via HTTP/GitHub Pages.</p>' +
              '<p style="opacity:.9">Aucune ressource trouvée pour: ' + slug + '</p>';
            target.dataset.loaded = 'error';
            return;
          }
          var path = attempts[i];
          fetch(path, {cache: 'no-store'})
            .then(function(resp){
              if(!resp.ok) throw new Error('HTTP ' + resp.status);
              return resp.text();
            })
            .then(function(html){
                  // Parse returned HTML and extract body content to avoid nested <html>/<body> styles
                  try{
                    var doc = new DOMParser().parseFromString(html, 'text/html');
                    var bodyHtml = doc && doc.body ? doc.body.innerHTML : html;
                    target.innerHTML = bodyHtml;
                  } catch(e){
                    target.innerHTML = html;
                  }
                  target.dataset.loaded = '1';
                  // Attach delegation to links inside modal so clicking an item loads it into the same modal
                  attachModalLinkHandler(target);
                })
            .catch(function(){
              tryNext(i+1);
            });
        })(0);
      }
    }

    // Delegated handler: intercept clicks on links inside modal content and load them via fetch
    function attachModalLinkHandler(container){
      if(!container) return;
      // Remove previous handler marker and add new
      if(container._modalHandlerAttached) return;
      container._modalHandlerAttached = true;

      container.addEventListener('click', function(e){
        var a = e.target.closest && e.target.closest('a');
        if(!a) return;
        var href = a.getAttribute('href');
        // Only intercept same-origin .html links
        if(!href || href.indexOf('.html') === -1) return;
        // Allow external absolute URLs to behave normally
        try{
          var url = new URL(href, window.location.href);
          if(url.origin !== window.location.origin) return;
        }catch(err){ return; }

        e.preventDefault();
        // show a small loading message
        container.innerHTML = '<p>Chargement…</p>';
        fetch(href, {cache: 'no-store'})
          .then(function(resp){ if(!resp.ok) throw new Error('HTTP '+resp.status); return resp.text(); })
          .then(function(html){
            try{
              var doc = new DOMParser().parseFromString(html, 'text/html');
              container.innerHTML = doc && doc.body ? doc.body.innerHTML : html;
            }catch(e){ container.innerHTML = html }
          })
          .catch(function(err){ container.innerHTML = '<p>Impossible de charger la page: '+String(err)+'</p>'; });
      });
    }
  }
  function closeWindow(id){
    var el = document.getElementById(id);
    if(!el) return;
    document.getElementById('overlay').style.display='none';
    el.style.display='none';
    el.setAttribute('aria-hidden','true');
  }
  // close on overlay click or Escape
  document.addEventListener('click', function(e){
    if(e.target && e.target.id==='overlay'){
      ['win-librairie','win-poeme','win-pense','win-souvenir'].forEach(function(id){closeWindow(id)});
    }
  });
  document.addEventListener('keydown', function(e){ if(e.key==='Escape'){ ['win-librairie','win-poeme','win-pense','win-souvenir'].forEach(function(id){closeWindow(id)}); } });
</script>
